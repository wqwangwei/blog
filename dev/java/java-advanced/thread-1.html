<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Java多线程知识汇总(1) | yupaits的博客</title>
    <meta name="description" content="俯仰一生，最惧无为。">
    <meta name="generator" content="VuePress 1.4.0">
    <link rel="icon" href="/favicon.ico">
  <meta name="robots" content="all">
  <meta name="author" content="yupaits">
  <meta name="keywords" content="yupaits, YupaiTS, 博客">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <script data-ad-client="ca-pub-8239100633886634" async="async" src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script src="https://hm.baidu.com/hm.js?f4c5dd32b8bff25dd776c28eb5bf436d"></script>
    
    <link rel="preload" href="/assets/css/0.styles.bdc7b98c.css" as="style"><link rel="preload" href="/assets/js/app.e20fb6cd.js" as="script"><link rel="preload" href="/assets/js/2.0f713cb8.js" as="script"><link rel="preload" href="/assets/js/115.a1d34811.js" as="script"><link rel="prefetch" href="/assets/js/10.72e46de1.js"><link rel="prefetch" href="/assets/js/100.8fa18e6b.js"><link rel="prefetch" href="/assets/js/101.2df27435.js"><link rel="prefetch" href="/assets/js/102.14867f64.js"><link rel="prefetch" href="/assets/js/103.aa02ae49.js"><link rel="prefetch" href="/assets/js/104.2309bfa1.js"><link rel="prefetch" href="/assets/js/105.84f33c41.js"><link rel="prefetch" href="/assets/js/106.05c5b20f.js"><link rel="prefetch" href="/assets/js/107.65e57a02.js"><link rel="prefetch" href="/assets/js/108.4e6c034c.js"><link rel="prefetch" href="/assets/js/109.84183b55.js"><link rel="prefetch" href="/assets/js/11.56e3520b.js"><link rel="prefetch" href="/assets/js/110.b189c675.js"><link rel="prefetch" href="/assets/js/111.4a055332.js"><link rel="prefetch" href="/assets/js/112.43cf4242.js"><link rel="prefetch" href="/assets/js/113.ded58a66.js"><link rel="prefetch" href="/assets/js/114.14cd95cb.js"><link rel="prefetch" href="/assets/js/116.49cccb92.js"><link rel="prefetch" href="/assets/js/117.fe36a678.js"><link rel="prefetch" href="/assets/js/118.0814a3c7.js"><link rel="prefetch" href="/assets/js/119.de1a2d0e.js"><link rel="prefetch" href="/assets/js/12.a7fb7fbe.js"><link rel="prefetch" href="/assets/js/120.c7febf01.js"><link rel="prefetch" href="/assets/js/121.37f6c176.js"><link rel="prefetch" href="/assets/js/122.dde024a3.js"><link rel="prefetch" href="/assets/js/123.da384693.js"><link rel="prefetch" href="/assets/js/124.842aac28.js"><link rel="prefetch" href="/assets/js/125.1d016869.js"><link rel="prefetch" href="/assets/js/126.ebd34905.js"><link rel="prefetch" href="/assets/js/127.57234e9c.js"><link rel="prefetch" href="/assets/js/128.5a63c4f2.js"><link rel="prefetch" href="/assets/js/129.172e3761.js"><link rel="prefetch" href="/assets/js/13.265929e5.js"><link rel="prefetch" href="/assets/js/130.1c5f253c.js"><link rel="prefetch" href="/assets/js/131.45b8747d.js"><link rel="prefetch" href="/assets/js/132.ca7341c8.js"><link rel="prefetch" href="/assets/js/133.8f78f833.js"><link rel="prefetch" href="/assets/js/134.fcd57011.js"><link rel="prefetch" href="/assets/js/135.0356e5de.js"><link rel="prefetch" href="/assets/js/136.18ea6f2c.js"><link rel="prefetch" href="/assets/js/137.6183ca45.js"><link rel="prefetch" href="/assets/js/138.241fa7f8.js"><link rel="prefetch" href="/assets/js/139.9ce23150.js"><link rel="prefetch" href="/assets/js/14.8a70aab6.js"><link rel="prefetch" href="/assets/js/140.210aa84a.js"><link rel="prefetch" href="/assets/js/141.1098052d.js"><link rel="prefetch" href="/assets/js/142.1b3954e4.js"><link rel="prefetch" href="/assets/js/143.6de161d8.js"><link rel="prefetch" href="/assets/js/144.b7b35bde.js"><link rel="prefetch" href="/assets/js/145.1073369b.js"><link rel="prefetch" href="/assets/js/146.d8884002.js"><link rel="prefetch" href="/assets/js/147.a9bd427b.js"><link rel="prefetch" href="/assets/js/148.a42328b1.js"><link rel="prefetch" href="/assets/js/149.85537b62.js"><link rel="prefetch" href="/assets/js/15.6969af02.js"><link rel="prefetch" href="/assets/js/150.ea5bf135.js"><link rel="prefetch" href="/assets/js/151.e612617a.js"><link rel="prefetch" href="/assets/js/152.bba3c553.js"><link rel="prefetch" href="/assets/js/153.2a85a02b.js"><link rel="prefetch" href="/assets/js/154.d5b20268.js"><link rel="prefetch" href="/assets/js/155.5b69f4a8.js"><link rel="prefetch" href="/assets/js/156.34e0a669.js"><link rel="prefetch" href="/assets/js/157.32f1be2e.js"><link rel="prefetch" href="/assets/js/158.7b23f7f7.js"><link rel="prefetch" href="/assets/js/159.b5c6f888.js"><link rel="prefetch" href="/assets/js/16.00aaf667.js"><link rel="prefetch" href="/assets/js/160.60182340.js"><link rel="prefetch" href="/assets/js/161.b83ddbe9.js"><link rel="prefetch" href="/assets/js/162.6a837daa.js"><link rel="prefetch" href="/assets/js/163.f778223d.js"><link rel="prefetch" href="/assets/js/164.0e61988b.js"><link rel="prefetch" href="/assets/js/165.4a341197.js"><link rel="prefetch" href="/assets/js/166.fb81a3a0.js"><link rel="prefetch" href="/assets/js/167.76ce9bbe.js"><link rel="prefetch" href="/assets/js/168.93ca9985.js"><link rel="prefetch" href="/assets/js/169.a0d5e24d.js"><link rel="prefetch" href="/assets/js/17.7574b8bc.js"><link rel="prefetch" href="/assets/js/170.0bb4bbbc.js"><link rel="prefetch" href="/assets/js/171.079b1d66.js"><link rel="prefetch" href="/assets/js/172.9989dc77.js"><link rel="prefetch" href="/assets/js/173.ab7eb58b.js"><link rel="prefetch" href="/assets/js/174.3b31c62a.js"><link rel="prefetch" href="/assets/js/175.6d64808a.js"><link rel="prefetch" href="/assets/js/176.b05644f9.js"><link rel="prefetch" href="/assets/js/177.7a1414fe.js"><link rel="prefetch" href="/assets/js/178.d70c02fb.js"><link rel="prefetch" href="/assets/js/179.bc3ebaaa.js"><link rel="prefetch" href="/assets/js/18.19f6c3a0.js"><link rel="prefetch" href="/assets/js/180.82ac5827.js"><link rel="prefetch" href="/assets/js/181.98bcc92b.js"><link rel="prefetch" href="/assets/js/182.b8cda863.js"><link rel="prefetch" href="/assets/js/183.e7579508.js"><link rel="prefetch" href="/assets/js/184.2ab43ebe.js"><link rel="prefetch" href="/assets/js/185.bfe8d6c6.js"><link rel="prefetch" href="/assets/js/186.11b6d517.js"><link rel="prefetch" href="/assets/js/187.0171296f.js"><link rel="prefetch" href="/assets/js/188.07e5e5f1.js"><link rel="prefetch" href="/assets/js/189.f6757acb.js"><link rel="prefetch" href="/assets/js/19.ca75de47.js"><link rel="prefetch" href="/assets/js/190.7b10e971.js"><link rel="prefetch" href="/assets/js/191.b1adceab.js"><link rel="prefetch" href="/assets/js/192.c79435b2.js"><link rel="prefetch" href="/assets/js/193.72f7079f.js"><link rel="prefetch" href="/assets/js/194.4717cf23.js"><link rel="prefetch" href="/assets/js/195.c89a7574.js"><link rel="prefetch" href="/assets/js/196.4a5f6596.js"><link rel="prefetch" href="/assets/js/197.1116c743.js"><link rel="prefetch" href="/assets/js/198.9abc5667.js"><link rel="prefetch" href="/assets/js/199.13e56055.js"><link rel="prefetch" href="/assets/js/20.de463e8a.js"><link rel="prefetch" href="/assets/js/200.a0b3559d.js"><link rel="prefetch" href="/assets/js/201.91a5b94a.js"><link rel="prefetch" href="/assets/js/202.eed1aa3e.js"><link rel="prefetch" href="/assets/js/203.a1a67bec.js"><link rel="prefetch" href="/assets/js/204.1d62b416.js"><link rel="prefetch" href="/assets/js/205.09d46357.js"><link rel="prefetch" href="/assets/js/206.99be27a8.js"><link rel="prefetch" href="/assets/js/207.59776753.js"><link rel="prefetch" href="/assets/js/208.7c10f24c.js"><link rel="prefetch" href="/assets/js/209.d697af43.js"><link rel="prefetch" href="/assets/js/21.4e978d93.js"><link rel="prefetch" href="/assets/js/210.ab5720f0.js"><link rel="prefetch" href="/assets/js/211.94581314.js"><link rel="prefetch" href="/assets/js/212.241ca14f.js"><link rel="prefetch" href="/assets/js/213.20332e6c.js"><link rel="prefetch" href="/assets/js/214.d3f045fb.js"><link rel="prefetch" href="/assets/js/215.4335e399.js"><link rel="prefetch" href="/assets/js/216.b41c4a74.js"><link rel="prefetch" href="/assets/js/217.4c0a4aba.js"><link rel="prefetch" href="/assets/js/218.e41e2c7e.js"><link rel="prefetch" href="/assets/js/219.3353b244.js"><link rel="prefetch" href="/assets/js/22.ef745e14.js"><link rel="prefetch" href="/assets/js/220.3f4b505a.js"><link rel="prefetch" href="/assets/js/221.7bbe760b.js"><link rel="prefetch" href="/assets/js/222.b4bb52ff.js"><link rel="prefetch" href="/assets/js/223.d94a3859.js"><link rel="prefetch" href="/assets/js/224.40947b80.js"><link rel="prefetch" href="/assets/js/225.e770e2ad.js"><link rel="prefetch" href="/assets/js/226.f93b38ed.js"><link rel="prefetch" href="/assets/js/227.a1b9e826.js"><link rel="prefetch" href="/assets/js/228.123f9a54.js"><link rel="prefetch" href="/assets/js/229.5376908c.js"><link rel="prefetch" href="/assets/js/23.29bd0ef3.js"><link rel="prefetch" href="/assets/js/230.f65c7051.js"><link rel="prefetch" href="/assets/js/231.6164a46a.js"><link rel="prefetch" href="/assets/js/232.1af0e64b.js"><link rel="prefetch" href="/assets/js/233.4b9dc691.js"><link rel="prefetch" href="/assets/js/234.abb715fc.js"><link rel="prefetch" href="/assets/js/24.1b2d4b35.js"><link rel="prefetch" href="/assets/js/25.04e4a714.js"><link rel="prefetch" href="/assets/js/26.abb428ee.js"><link rel="prefetch" href="/assets/js/27.6facf436.js"><link rel="prefetch" href="/assets/js/28.9c112699.js"><link rel="prefetch" href="/assets/js/29.7039e010.js"><link rel="prefetch" href="/assets/js/3.cf107a1d.js"><link rel="prefetch" href="/assets/js/30.336e68ee.js"><link rel="prefetch" href="/assets/js/31.918c0fb0.js"><link rel="prefetch" href="/assets/js/32.7bb8b56f.js"><link rel="prefetch" href="/assets/js/33.b95c4e19.js"><link rel="prefetch" href="/assets/js/34.ed0f5453.js"><link rel="prefetch" href="/assets/js/35.fc9a1abe.js"><link rel="prefetch" href="/assets/js/36.41455b47.js"><link rel="prefetch" href="/assets/js/37.d1fb52d8.js"><link rel="prefetch" href="/assets/js/38.15455e23.js"><link rel="prefetch" href="/assets/js/39.2c4fcf46.js"><link rel="prefetch" href="/assets/js/4.47a347c3.js"><link rel="prefetch" href="/assets/js/40.5768cfd6.js"><link rel="prefetch" href="/assets/js/41.548a9662.js"><link rel="prefetch" href="/assets/js/42.523a4043.js"><link rel="prefetch" href="/assets/js/43.ed930706.js"><link rel="prefetch" href="/assets/js/44.cf192ce5.js"><link rel="prefetch" href="/assets/js/45.d4e856be.js"><link rel="prefetch" href="/assets/js/46.07efca8e.js"><link rel="prefetch" href="/assets/js/47.71029be4.js"><link rel="prefetch" href="/assets/js/48.97c8e472.js"><link rel="prefetch" href="/assets/js/49.7f6fb829.js"><link rel="prefetch" href="/assets/js/5.3a265dd7.js"><link rel="prefetch" href="/assets/js/50.3022459f.js"><link rel="prefetch" href="/assets/js/51.51c73a34.js"><link rel="prefetch" href="/assets/js/52.690f17aa.js"><link rel="prefetch" href="/assets/js/53.fad51141.js"><link rel="prefetch" href="/assets/js/54.b59788d6.js"><link rel="prefetch" href="/assets/js/55.8c6994e2.js"><link rel="prefetch" href="/assets/js/56.6561e278.js"><link rel="prefetch" href="/assets/js/57.38e01d9f.js"><link rel="prefetch" href="/assets/js/58.e667157d.js"><link rel="prefetch" href="/assets/js/59.769863ad.js"><link rel="prefetch" href="/assets/js/6.0fe15071.js"><link rel="prefetch" href="/assets/js/60.b123a76a.js"><link rel="prefetch" href="/assets/js/61.4e362490.js"><link rel="prefetch" href="/assets/js/62.a94c1263.js"><link rel="prefetch" href="/assets/js/63.242a14d9.js"><link rel="prefetch" href="/assets/js/64.1c9658a0.js"><link rel="prefetch" href="/assets/js/65.c0e7e4df.js"><link rel="prefetch" href="/assets/js/66.1d078735.js"><link rel="prefetch" href="/assets/js/67.8d6e6007.js"><link rel="prefetch" href="/assets/js/68.c3e238e3.js"><link rel="prefetch" href="/assets/js/69.f21947ed.js"><link rel="prefetch" href="/assets/js/7.5c9de739.js"><link rel="prefetch" href="/assets/js/70.da91f7be.js"><link rel="prefetch" href="/assets/js/71.3379a033.js"><link rel="prefetch" href="/assets/js/72.b6969660.js"><link rel="prefetch" href="/assets/js/73.7f6324cd.js"><link rel="prefetch" href="/assets/js/74.b6021cfd.js"><link rel="prefetch" href="/assets/js/75.8cd90a81.js"><link rel="prefetch" href="/assets/js/76.f843b1ba.js"><link rel="prefetch" href="/assets/js/77.5e85c67f.js"><link rel="prefetch" href="/assets/js/78.2091b139.js"><link rel="prefetch" href="/assets/js/79.9ebf460f.js"><link rel="prefetch" href="/assets/js/8.39be7ff3.js"><link rel="prefetch" href="/assets/js/80.80282ca6.js"><link rel="prefetch" href="/assets/js/81.ed6ea13f.js"><link rel="prefetch" href="/assets/js/82.052ff711.js"><link rel="prefetch" href="/assets/js/83.2828b82e.js"><link rel="prefetch" href="/assets/js/84.0dddd525.js"><link rel="prefetch" href="/assets/js/85.2cf1d549.js"><link rel="prefetch" href="/assets/js/86.c9871533.js"><link rel="prefetch" href="/assets/js/87.c7e52ed1.js"><link rel="prefetch" href="/assets/js/88.df58a95a.js"><link rel="prefetch" href="/assets/js/89.bd1a7562.js"><link rel="prefetch" href="/assets/js/9.a00f2c14.js"><link rel="prefetch" href="/assets/js/90.dcd9d2eb.js"><link rel="prefetch" href="/assets/js/91.cc96768c.js"><link rel="prefetch" href="/assets/js/92.0f34af25.js"><link rel="prefetch" href="/assets/js/93.f69e1777.js"><link rel="prefetch" href="/assets/js/94.35bfd5d3.js"><link rel="prefetch" href="/assets/js/95.1ef38feb.js"><link rel="prefetch" href="/assets/js/96.c2a83340.js"><link rel="prefetch" href="/assets/js/97.796cdaf4.js"><link rel="prefetch" href="/assets/js/98.2f819f15.js"><link rel="prefetch" href="/assets/js/99.a50b3217.js">
    <link rel="stylesheet" href="/assets/css/0.styles.bdc7b98c.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/favicon.ico" alt="yupaits的博客" class="logo"> <span class="site-name can-hide">yupaits的博客</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/blog/" class="nav-link">
  博客
</a></div><div class="nav-item"><a href="/posts/" class="nav-link">
  文章
</a></div><div class="nav-item"><a href="/design/" class="nav-link">
  设计
</a></div><div class="nav-item"><a href="/dev/" class="nav-link router-link-active">
  开发
</a></div><div class="nav-item"><a href="/sites.html" class="nav-link">
  站点
</a></div><div class="nav-item"><a href="/tools.html" class="nav-link">
  工具
</a></div><div class="nav-item"><a href="/projects/" class="nav-link">
  项目
</a></div><div class="nav-item"><a href="/books.html" class="nav-link">
  书单
</a></div><div class="nav-item"><a href="/about.html" class="nav-link">
  关于我
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Select language" class="dropdown-title"><span class="title">选择语言</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/dev/java/java-advanced/thread-1.html" class="nav-link router-link-exact-active router-link-active">
  简体中文
</a></li><li class="dropdown-item"><!----> <a href="/en/" class="nav-link">
  English
</a></li></ul></div></div> <a href="https://github.com/yupaits" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/blog/" class="nav-link">
  博客
</a></div><div class="nav-item"><a href="/posts/" class="nav-link">
  文章
</a></div><div class="nav-item"><a href="/design/" class="nav-link">
  设计
</a></div><div class="nav-item"><a href="/dev/" class="nav-link router-link-active">
  开发
</a></div><div class="nav-item"><a href="/sites.html" class="nav-link">
  站点
</a></div><div class="nav-item"><a href="/tools.html" class="nav-link">
  工具
</a></div><div class="nav-item"><a href="/projects/" class="nav-link">
  项目
</a></div><div class="nav-item"><a href="/books.html" class="nav-link">
  书单
</a></div><div class="nav-item"><a href="/about.html" class="nav-link">
  关于我
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Select language" class="dropdown-title"><span class="title">选择语言</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/dev/java/java-advanced/thread-1.html" class="nav-link router-link-exact-active router-link-active">
  简体中文
</a></li><li class="dropdown-item"><!----> <a href="/en/" class="nav-link">
  English
</a></li></ul></div></div> <a href="https://github.com/yupaits" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span></span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/dev/" class="sidebar-link">软件开发</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>数据结构</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/dev/data-structure/common-data-structure.html" class="sidebar-link">常见数据结构</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>算法</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/dev/algorithm/search.html" class="sidebar-link">查找算法</a></li><li><a href="/dev/algorithm/sort.html" class="sidebar-link">排序算法</a></li><li><a href="/dev/algorithm/graph.html" class="sidebar-link">图算法</a></li><li><a href="/dev/algorithm/bit-operation.html" class="sidebar-link">位运算</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>设计模式</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/dev/design-pattern/overview.html" class="sidebar-link">设计模式概述</a></li><li><a href="/dev/design-pattern/gof-23-patterns.html" class="sidebar-link">GoF的23种设计模式的分类和功能</a></li><li><a href="/dev/design-pattern/singleton.html" class="sidebar-link">单例模式</a></li><li><a href="/dev/design-pattern/factory.html" class="sidebar-link">工厂模式</a></li><li><a href="/dev/design-pattern/decorator.html" class="sidebar-link">装饰模式</a></li><li><a href="/dev/design-pattern/adapter.html" class="sidebar-link">适配器模式</a></li><li><a href="/dev/design-pattern/observer.html" class="sidebar-link">观察者模式</a></li><li><a href="/dev/design-pattern/chain-of-responsibility.html" class="sidebar-link">责任链模式</a></li><li><a href="/dev/design-pattern/strategy.html" class="sidebar-link">策略模式</a></li><li><a href="/dev/design-pattern/composite.html" class="sidebar-link">合成模式</a></li><li><a href="/dev/design-pattern/template-method.html" class="sidebar-link">模板方法模式</a></li><li><a href="/dev/design-pattern/proxy.html" class="sidebar-link">代理模式</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>分布式系统原理</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/dev/distribution/distribution-system.html" class="sidebar-link">分布式系统</a></li><li><a href="/dev/distribution/cap.html" class="sidebar-link">CAP理论</a></li><li><a href="/dev/distribution/eventually-consistent.html" class="sidebar-link">最终一致性</a></li><li><a href="/dev/distribution/idempotent.html" class="sidebar-link">幂等操作</a></li><li><a href="/dev/distribution/disaster-tolerance.html" class="sidebar-link">可容灾分布式系统设计</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>大型网络应用架构</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/dev/web-architecture/architecture-factors.html" class="sidebar-link">架构五要素</a></li><li><a href="/dev/web-architecture/mq.html" class="sidebar-link">消息中间件</a></li><li><a href="/dev/web-architecture/cache.html" class="sidebar-link">缓存</a></li><li><a href="/dev/web-architecture/load-balance.html" class="sidebar-link">负载均衡</a></li><li><a href="/dev/web-architecture/cluster.html" class="sidebar-link">集群技术</a></li><li><a href="/dev/web-architecture/data-sync.html" class="sidebar-link">数据同步</a></li><li><a href="/dev/web-architecture/high-availability.html" class="sidebar-link">高可用</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Java基础知识</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/dev/java/java-base/basic-datatypes.html" class="sidebar-link">基本数据类型</a></li><li><a href="/dev/java/java-base/operator.html" class="sidebar-link">运算符</a></li><li><a href="/dev/java/java-base/choose-loop.html" class="sidebar-link">选择与循环语句</a></li><li><a href="/dev/java/java-base/class-object.html" class="sidebar-link">类与对象</a></li><li><a href="/dev/java/java-base/extend-implements.html" class="sidebar-link">继承与实现</a></li><li><a href="/dev/java/java-base/exception.html" class="sidebar-link">异常</a></li><li><a href="/dev/java/java-base/package-jar.html" class="sidebar-link">package与jar包</a></li><li><a href="/dev/java/java-base/serialize-deserialize.html" class="sidebar-link">序列化与反序列化</a></li><li><a href="/dev/java/java-base/regex.html" class="sidebar-link">正则表达式</a></li><li><a href="/dev/java/java-base/overload-override.html" class="sidebar-link">重载与覆盖</a></li><li><a href="/dev/java/java-base/collection.html" class="sidebar-link">Collection接口</a></li><li><a href="/dev/java/java-base/set.html" class="sidebar-link">Set相关</a></li><li><a href="/dev/java/java-base/list.html" class="sidebar-link">List相关</a></li><li><a href="/dev/java/java-base/queue.html" class="sidebar-link">Queue相关</a></li><li><a href="/dev/java/java-base/map.html" class="sidebar-link">Map相关</a></li><li><a href="/dev/java/java-base/thread.html" class="sidebar-link">Thread</a></li><li><a href="/dev/java/java-base/runnable.html" class="sidebar-link">Runnable</a></li><li><a href="/dev/java/java-base/callable.html" class="sidebar-link">Callable</a></li><li><a href="/dev/java/java-base/thread-state.html" class="sidebar-link">线程状态</a></li><li><a href="/dev/java/java-base/thread-priority.html" class="sidebar-link">优先级</a></li><li><a href="/dev/java/java-base/file.html" class="sidebar-link">File类</a></li><li><a href="/dev/java/java-base/byte-stream.html" class="sidebar-link">字节流</a></li><li><a href="/dev/java/java-base/stream.html" class="sidebar-link">字符流</a></li><li><a href="/dev/java/java-base/convert-stream.html" class="sidebar-link">转换流</a></li><li><a href="/dev/java/java-base/zip-stream.html" class="sidebar-link">压缩流</a></li><li><a href="/dev/java/java-base/tcp.html" class="sidebar-link">TCP编程</a></li><li><a href="/dev/java/java-base/udp.html" class="sidebar-link">UDP编程</a></li><li><a href="/dev/java/java-base/generic.html" class="sidebar-link">Java泛型</a></li><li><a href="/dev/java/java-base/reflection-api.html" class="sidebar-link">提供api方法取得类的结构</a></li><li><a href="/dev/java/java-base/invoke.html" class="sidebar-link">调用类的方法</a></li><li><a href="/dev/java/java-base/dynamic-proxy.html" class="sidebar-link">动态代理</a></li><li><a href="/dev/java/java-base/ArrayList.html" class="sidebar-link">ArrayList</a></li><li><a href="/dev/java/java-base/LinkedList.html" class="sidebar-link">LinkedList</a></li><li><a href="/dev/java/java-base/CopyOnWriteArrayList.html" class="sidebar-link">CopyOnWriteArrayList</a></li><li><a href="/dev/java/java-base/HashMap.html" class="sidebar-link">HashMap</a></li><li><a href="/dev/java/java-base/LinkedHashMap.html" class="sidebar-link">LinkedHashMap</a></li><li><a href="/dev/java/java-base/ConcurrentHashMap.html" class="sidebar-link">ConcurrentHashMap</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Java进阶知识</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/dev/java/java-advanced/java-keywords.html" class="sidebar-link">Java关键字</a></li><li><a href="/dev/java/java-advanced/regex.html" class="sidebar-link">正则表达式</a></li><li><a href="/dev/java/java-advanced/lock.html" class="sidebar-link">常见锁</a></li><li><a href="/dev/java/java-advanced/common-libs.html" class="sidebar-link">常用Java类库</a></li><li><a href="/dev/java/java-advanced/system-property.html" class="sidebar-link">Java的System.getProperty()方法使用</a></li><li><a href="/dev/java/java-advanced/lambda.html" class="sidebar-link">Java8函数式编程（lambda表达式）</a></li><li><a href="/dev/java/java-advanced/java-thread.html" class="sidebar-link">Java多线程知识点</a></li><li><a href="/dev/java/java-advanced/threadlocal.html" class="sidebar-link">ThreadLocal原理机制</a></li><li><a href="/dev/java/java-advanced/hashmap-expansion.html" class="sidebar-link">HashMap的扩容机制</a></li><li><a href="/dev/java/java-advanced/exception.html" class="sidebar-link">Java异常Exception</a></li><li><a href="/dev/java/java-advanced/problems.html" class="sidebar-link">常见问题</a></li><li><a href="/dev/java/java-advanced/nio.html" class="sidebar-link">NIO介绍</a></li><li><a href="/dev/java/java-advanced/tomcat-nio-model.html" class="sidebar-link">深度解读Tomcat中的NIO模型</a></li><li><a href="/dev/java/java-advanced/epoll-selector.html" class="sidebar-link">epoll浅析以及nio中的Selector</a></li><li><a href="/dev/java/java-advanced/linux-io.html" class="sidebar-link">Linux IO模式及select、poll、epoll详解</a></li><li><a href="/dev/java/java-advanced/thread-1.html" class="active sidebar-link">Java多线程知识汇总(1)</a></li><li><a href="/dev/java/java-advanced/thread-2.html" class="sidebar-link">Java多线程知识汇总(2)</a></li><li><a href="/dev/java/java-advanced/thread-3.html" class="sidebar-link">Java多线程知识汇总(3)</a></li><li><a href="/dev/java/java-advanced/jdk-concurrent-class.html" class="sidebar-link">JDK并发包里常用的类</a></li><li><a href="/dev/java/java-advanced/concurrent-collection.html" class="sidebar-link">Java并发源码合集</a></li><li><a href="/dev/java/java-advanced/netty.html" class="sidebar-link">Netty长连接服务</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>JVM虚拟机</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/dev/java/java-jvm/jvm-mem.html" class="sidebar-link">内存结构</a></li><li><a href="/dev/java/java-jvm/class-loader.html" class="sidebar-link">类加载机制</a></li><li><a href="/dev/java/java-jvm/gc.html" class="sidebar-link">垃圾回收</a></li><li><a href="/dev/java/java-jvm/jvm-params.html" class="sidebar-link">JVM参数</a></li><li><a href="/dev/java/java-jvm/console.html" class="sidebar-link">JVM自带命令</a></li><li><a href="/dev/java/java-jvm/tuning-collection.html" class="sidebar-link">JVM调优</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Spring</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/dev/spring/spring-transactions.html" class="sidebar-link">深入理解Spring事务原理</a></li><li><a href="/dev/spring/spring-knowledge-points.html" class="sidebar-link">Spring知识点</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Spring Boot</span> <!----></p> <!----></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Spring Cloud</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/dev/spring-cloud/service-discovery.html" class="sidebar-link">快速搭建微服务-注册中心、服务发现</a></li><li><a href="/dev/spring-cloud/undertow.html" class="sidebar-link">快速搭建微服务-服务容器</a></li><li><a href="/dev/spring-cloud/ribbon.html" class="sidebar-link">快速搭建微服务-服务调用</a></li><li><a href="/dev/spring-cloud/config-server.html" class="sidebar-link">快速搭建微服务-配置中心</a></li><li><a href="/dev/spring-cloud/bus-amqp.html" class="sidebar-link">快速搭建微服务-消息总线</a></li><li><a href="/dev/spring-cloud/hystrix.html" class="sidebar-link">快速搭建微服务-熔断器</a></li><li><a href="/dev/spring-cloud/admin-dashboard.html" class="sidebar-link">快速搭建微服务-服务监控</a></li><li><a href="/dev/spring-cloud/sleuth.html" class="sidebar-link">快速搭建微服务-服务链路追踪</a></li><li><a href="/dev/spring-cloud/security.html" class="sidebar-link">快速搭建微服务-服务安全</a></li><li><a href="/dev/spring-cloud/api-gateway.html" class="sidebar-link">快速搭建微服务-API网关</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Golang</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/dev/golang/gin-doc.html" class="sidebar-link">web框架Gin使用手册</a></li><li><a href="/dev/golang/gorm.html" class="sidebar-link">ORM框架gorm使用手册</a></li><li><a href="/dev/golang/go-spider.html" class="sidebar-link">爬虫框架go_spider</a></li><li><a href="/dev/golang/fyne.html" class="sidebar-link">跨平台GUI工具fyne</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>移动开发</span> <!----></p> <!----></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>微信开发</span> <!----></p> <!----></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Docker</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/dev/docker/install-docker.html" class="sidebar-link">安装Docker</a></li><li><a href="/dev/docker/Dockerfile.html" class="sidebar-link">Dockerfile指令</a></li><li><a href="/dev/docker/docker-image.html" class="sidebar-link">Docker镜像命令</a></li><li><a href="/dev/docker/docker-container.html" class="sidebar-link">Docker容器命令</a></li><li><a href="/dev/docker/docker-compose-yml.html" class="sidebar-link">docker-compose.yml命令</a></li><li><a href="/dev/docker/docker-compose.html" class="sidebar-link">docker-compose命令</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>玩转树莓派</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/dev/raspberry-pi/go-pi-monitor.html" class="sidebar-link">树莓派运行情况监控</a></li><li><a href="/dev/raspberry-pi/aria2-downloader.html" class="sidebar-link">搭建基于 Aria2 的下载机</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="java多线程知识汇总-1"><a href="#java多线程知识汇总-1" class="header-anchor">#</a> Java多线程知识汇总(1)</h1> <blockquote><p>引用自<a href="https://blog.csdn.net/u013256816/article/details/51325246" target="_blank" rel="noopener noreferrer">Java多线程知识小抄集(一)<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></blockquote> <ol><li>interrupted与isInterrupted的区别</li></ol> <p>interrupted()：测试当前线程是否已经是中断状态，执行后具有状态标志清除为false的功能。
isInterrupted()：测试线程Thread对象是否已经是中断状态，但不清除状态标志。</p> <p>方法：</p> <div class="language-Java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">boolean</span> <span class="token function">interrupted</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isInterrupted</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">isInterrupted</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">isInterrupted</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">private</span> <span class="token keyword">native</span> <span class="token keyword">boolean</span> <span class="token function">isInterrupted</span><span class="token punctuation">(</span><span class="token keyword">boolean</span> <span class="token class-name">ClearInterrupted</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token number">1234567</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><ol start="2"><li>终止正在运行的线程的三种方法：</li></ol> <p>使用退出标志，是线程正常退出，也就是当run方法完成后线程终止；
使用stop方法强行终止线程，但是不推荐使用这个方法，因为stop和suspend及resume一样都是作废过期的方法，使用它们可能产生不可预料的结果；
使用interrupt方法中断线程；（推荐）</p> <ol start="3"><li>yield方法</li></ol> <p>yield()方法的作用是放弃当前的CPU资源，将它让给其他的任务去占用CPU执行时间。但放弃时间不确定，有可能刚刚放弃，马上又获得CPU时间片。这里需要注意的是yield()方法和sleep方法一样，线程并不会让出锁，和wait不同。</p> <ol start="4"><li>线程的优先级</li></ol> <p>Java中线程的优先级分为1-10这10个等级，如果小于1或大于10则JDK抛出IllegalArgumentException()的异常，默认优先级是5。在Java中线程的优先级具有继承性，比如A线程启动B线程，则B线程的优先级与A是一样的。注意程序正确性不能依赖线程的优先级高低，因为操作系统可以完全不理会Java线程对于优先级的决定。</p> <ol start="5"><li>Java中线程的状态</li></ol> <p>New, Runnable, Blocked, Waiting, Time_waiting, Terminated.</p> <ol start="6"><li>守护线程</li></ol> <p>Java中有两种线程，一种是用户线程，另一种是守护线程。当进程中不存在非守护线程了，则守护线程自动销毁。通过setDaemon(true)设置线程为后台线程。注意thread.setDaemon(true)必须在thread.start()之前设置，否则会报IllegalThreadStateException异常；在Daemon线程中产生的新线程也是Daemon的；在使用ExecutorSerice等多线程框架时，会把守护线程转换为用户线程，并且也会把优先级设置为Thread.NORM_PRIORITY。在构建Daemon线程时，不能依靠finally块中的内容来确保执行关闭或清理资源的逻辑。更多详细内容可参考《Java守护线程概述》</p> <ol start="7"><li>synchronized的类锁与对象锁</li></ol> <p>类锁：在方法上加上static synchronized的锁，或者synchronized(xxx.class)的锁。如下代码中的method1和method2：
对象锁：参考method4, method5,method6.</p> <div class="language-Java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">LockStrategy</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token class-name">Object</span> object1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">synchronized</span> <span class="token keyword">void</span> <span class="token function">method1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">method2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">synchronized</span><span class="token punctuation">(</span><span class="token class-name">LockStrategy</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">synchronized</span> <span class="token keyword">void</span> <span class="token function">method4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">method5</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">synchronized</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">method6</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">synchronized</span><span class="token punctuation">(</span>object1<span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><p>注意方法method4和method5中的同步块也是互斥的。
下面做一道习题来加深一下对对象锁和类锁的理解：
有一个类这样定义</p> <div class="language-Java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SynchronizedTest</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">synchronized</span> <span class="token keyword">void</span> <span class="token function">method1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">synchronized</span> <span class="token keyword">void</span> <span class="token function">method2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">synchronized</span> <span class="token keyword">void</span> <span class="token function">method3</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">synchronized</span> <span class="token keyword">void</span> <span class="token function">method4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>那么，有SynchronizedTest的两个实例a和b，对于一下的几个选项有哪些能被一个以上的线程同时访问呢？
A. a.method1() vs. a.method2()
B. a.method1() vs. b.method1()
C. a.method3() vs. b.method4()
D. a.method3() vs. b.method3()
E. a.method1() vs. a.method3()
答案是什么呢？BE
有关Java中的锁的详细信息，可以参考<a href="http://blog.csdn.net/u013256816/article/details/51204385" target="_blank" rel="noopener noreferrer">《Java中的锁》<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <ol start="8"><li>同步不具备继承性</li></ol> <p>当一个线程执行的代码出现异常时，其所持有的锁会自动释放。<strong>同步不具有继承性</strong>（声明为synchronized的父类方法A，在子类中重写之后并不具备synchronized的特性）。</p> <ol start="9"><li>wait, notify, notifyAll用法</li></ol> <p>只能在同步方法或者同步块中使用wait()方法。在执行wait()方法后，当前线程释放锁（这点与sleep和yield方法不同）。调用了wait函数的线程会一直等待，知道有其他线程调用了同一个对象的notify或者notifyAll方法才能被唤醒，需要注意的是：被唤醒并不代表立刻获得对象的锁，要等待执行notify()方法的线程执行完，即退出synchronized代码块后，当前线程才会释放锁，而呈wait状态的线程才可以获取该对象锁。</p> <p>如果调用wait()方法时没有持有适当的锁，则抛出IllegalMonitorStateException，它是RuntimeException的一个子类，因此，不需要try-catch语句进行捕获异常。</p> <p>notify方法只会（随机）唤醒一个正在等待的线程，而notifyAll方法会唤醒所有正在等待的线程。如果一个对象之前没有调用wait方法，那么调用notify方法是没有任何影响的。
详细可以参考<a href="http://blog.csdn.net/u013256816/article/details/50440123" target="_blank" rel="noopener noreferrer">《JAVA线程间协作：wait.notify.notifyAll》<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p>带参数的wait(long timeout)或者wait(long timeout, int nanos)方法的功能是等待某一时间内是否有线程对锁进行唤醒，如果超过这个时间则自动唤醒。</p> <ol start="10"><li>管道</li></ol> <p>在Java中提供了各种各样的输入/输出流Stream，使我们能够很方便地对数据进行操作，其中管道流（pipeStream)是一种特殊的流，用于在不同线程间直接传送数据。一个线程发送数据到输出管道，另一个线程从输入管道中读数据，通过使用管道，实现不同线程间的通信，而无须借助类似临时文件之类的东西。在JDK中使用4个类来使线程间可以进行通信：PipedInputStream, PipedOutputStream, PipedReader, PipedWriter。使用代码类似inputStream.connect(outputStream)或outputStream.connect(inputStream)使两个Stream之间产生通信连接。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>几种进程间的通信方式 
- 有名管道 (named pipe) ： 有名管道也是半双工的通信方式，但是它允许无亲缘关系进程间的通信。 
- 信号量( semophore ) ： 信号量是一个计数器，可以用来控制多个进程对共享资源的访问。它常作为一种锁机制，防止某进程正在访问共享资源时，其他进程也访问该资源。因此，主要作为进程间以及同一进程内不同线程之间的同步手段。 
- 消息队列( message queue ) ： 消息队列是由消息的链表，存放在内核中并由消息队列标识符标识。消息队列克服了信号传递信息少、管道只能承载无格式字节流以及缓冲区大小受限等缺点。 
- 信号 ( sinal ) ： 信号是一种比较复杂的通信方式，用于通知接收进程某个事件已经发生。 
- 共享内存( shared memory ) ：共享内存就是映射一段能被其他进程所访问的内存，这段共享内存由一个进程创建，但多个进程都可以访问。共享内存是最快的 IPC 方式，它是针对其他进程间通信方式运行效率低而专门设计的。它往往与其他通信机制，如信号两，配合使用，来实现进程间的同步和通信。 
- 套接字( socket ) ： 套解口也是一种进程间通信机制，与其他通信机制不同的是，它可用于不同及其间的进程通信。
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><ol start="11"><li>join方法</li></ol> <p>如果一个线程A执行了thread.join()语句，其含义是：当前线程A等待thread线程终止之后才从thread.join()返回。join与synchronized的区别是：join在内部使用wait()方法进行等待，而synchronized关键字使用的是“对象监视器”做为同步。
join提供了另外两种实现方法：join(long millis)和join(long millis, int nanos)，至多等待多长时间而退出等待(释放锁)，退出等待之后还可以继续运行。内部是通过wait方法来实现的。</p> <p>可以参考一下一个例子：</p> <div class="language-Java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;method main begin-----&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">Thread</span> t <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Runnable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">try</span>
            <span class="token punctuation">{</span>
                <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>MILLISECONDS<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
t<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
t<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;method main end-----&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><p>运行结果：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>method main begin-----
0
1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
method main end-----
19
20
21
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><p>12.ThreadLocal</p> <p>ThreadLocal可以实现每个线程绑定自己的值，即每个线程有各自独立的副本而互相不受影响。一共有四个方法：get, set, remove, initialValue。可以重写initialValue()方法来为ThreadLocal赋初值。如下：</p> <div class="language-Java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">ThreadLocal</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Long</span><span class="token punctuation">&gt;</span></span> TIME_THREADLOCAL <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ThreadLocal</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Long</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token class-name">Long</span> <span class="token function">initialValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>ThreadLocal建议设置为static类型的。
使用类InheritableThreadLocal可以在子线程中取得父线程继承下来的值。可以采用重写childValue（Object parentValue）方法来更改继承的值。
查看案例：</p> <div class="language-Java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">InheriableThreadLocal</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">InheritableThreadLocal</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> itl <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">InheritableThreadLocal</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token annotation punctuation">@Override</span> <span class="token keyword">protected</span> <span class="token class-name">Object</span> <span class="token function">initialValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token annotation punctuation">@Override</span> <span class="token keyword">protected</span> <span class="token class-name">Object</span> <span class="token function">childValue</span><span class="token punctuation">(</span><span class="token class-name">Object</span> parentValue<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">return</span> parentValue<span class="token operator">+</span><span class="token string">&quot; which plus in subThread.&quot;</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Main: get value = &quot;</span><span class="token operator">+</span>itl<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Thread</span> a <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Runnable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token annotation punctuation">@Override</span> <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;: get value = &quot;</span><span class="token operator">+</span>itl<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        a<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div><p>运行结果：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>Main: get value = 1461585405704
Thread-0: get value = 1461585405704 which plus in subThread.
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>如果去掉@Override protected Object childValue(Object parentValue)方法运行结果：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>Main: get value = 1461585396073
Thread-0: get value = 1461585396073
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><strong>注意：在线程池的情况下，在ThreadLocal业务周期处理完成时，最好显式的调用remove()方法，清空”线程局部变量”中的值。正常情况下使用ThreadLocal不会造成内存溢出，弱引用的只是threadLocal，保存的值依然是强引用的，如果threadLocal依然被其他对象强引用，”线程局部变量”是无法回收的。</strong></p> <ol start="13"><li>ReentrantLock</li></ol> <p>ReentrantLock提供了tryLock方法，tryLock调用的时候，如果锁被其他线程持有，那么tryLock会立即返回，返回结果为false；如果锁没有被其他线程持有，那么当前调用线程会持有锁，并且tryLock返回的结果为true。</p> <div class="language-Java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">boolean</span> <span class="token function">tryLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">boolean</span> <span class="token function">tryLock</span><span class="token punctuation">(</span><span class="token keyword">long</span> timeout<span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span> unit<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>可以在构造ReentranLock时使用公平锁，公平锁是指多个线程在等待同一个锁时，必须按照申请锁的先后顺序来一次获得锁。synchronized中的锁时非公平的，默认情况下ReentrantLock也是非公平的，但是可以在构造函数中指定使用公平锁。</p> <div class="language-Java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">ReentrantLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token class-name">ReentrantLock</span><span class="token punctuation">(</span><span class="token keyword">boolean</span> fair<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>对于ReentrantLock来说，还有一个十分实用的特性，它可以同时绑定多个Condition条件，以实现更精细化的同步控制。
ReentrantLock使用方式如下：</p> <div class="language-Java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">Lock</span> lock <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ReentrantLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
lock<span class="token punctuation">.</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">try</span><span class="token punctuation">{</span>
<span class="token punctuation">}</span><span class="token keyword">finally</span><span class="token punctuation">{</span>
    lock<span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><ol start="14"><li>ReentrantLock中的其余方法</li></ol> <ul><li>int getHoldCount()：查询当前线程保持此锁定的个数，也就是调用lock()方法的次数。</li> <li>int getQueueLength()：返回正等待获取此锁定的线程估计数。比如有5个线程，1个线程首先执行await()方法，那么在调用getQueueLength方法后返回值是4，说明有4个线程在等待lock的释放。</li> <li>int getWaitQueueLength(Condition condition)：返回等待此锁定相关的给定条件Condition的线程估计数。比如有5个线程，每个线程都执行了同一个condition对象的await方法，则调用getWaitQueueLength(Condition condition)方法时返回的int值是5。</li> <li>boolean hasQueuedThread(Thread thread)：查询指定线程是否正在等待获取此锁定。</li> <li>boolean hasQueuedThreads()：查询是否有线程正在等待获取此锁定。</li> <li>boolean hasWaiters(Condition condition)：查询是否有线程正在等待与此锁定有关的condition条件。</li> <li>boolean isFair()：判断是不是公平锁。</li> <li>boolean isHeldByCurrentThread()：查询当前线程是否保持此锁定。</li> <li>boolean isLocked()：查询此锁定是否由任意线程保持。</li> <li>void lockInterruptibly()：如果当前线程未被中断，则获取锁定，如果已经被中断则出现异常。</li></ul> <ol start="15"><li>Condition</li></ol> <p>一个Condition和一个Lock关联在一起，就想一个条件队列和一个内置锁相关联一样。要创建一个Condition，可以在相关联的Lock上调用Lock.newCondition方法。正如Lock比内置加锁提供了更为丰富的功能，Condition同样比内置条件队列提供了更丰富的功能：在每个锁上可存在多个等待、条件等待可以是可中断的或者不可中断的、基于时限的等待，以及公平的或非公平的队列操作。与内置条件队列不同的是，对于每个Lock，可以有任意数量的Condition对象。Condition对象继承了相关的Lock对象的公平性，对于公平的锁，线程会依照FIFO顺序从Condition.await中释放。</p> <p>注意：在Condition对象中，与wait,notify和notifyAll方法对于的分别是await,signal,signalAll。但是，Condition对Object进行了扩展，因而它也包含wait和notify方法。一定要确保使用的版本——await和signal.</p> <p>详细可参考<a href="http://blog.csdn.net/u013256816/article/details/50445241" target="_blank" rel="noopener noreferrer">《JAVA线程间协作：Condition》<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <ol start="16"><li>读写锁ReentrantReadWriteLock</li></ol> <p>读写锁表示也有两个锁，一个是读操作相关的锁，也称为共享锁；另一个是写操作相关的锁，也叫排它锁。也就是多个读锁之间不互斥，读锁与写锁互斥，写锁与写锁互斥。在没有Thread进行写操作时，进行读取操作的多个Thread都可以获取读锁，而进行写入操作的Thread只有在获取写锁后才能进行写入操作。即多个Thread可以同时进行读取操作，但是同一时刻只允许一个Thread进行写入操作。(lock.readlock.lock(), lock.readlock.unlock, lock.writelock.lock, lock.writelock.unlock)</p> <ol start="17"><li>Timer的使用</li></ol> <p>JDK中的Timer类主要负责计划任务的功能，也就是在指定时间开始执行某一任务。Timer类的主要作用就是设置计划任务，但封装任务的类却是TimerTask类（public abstract class TimerTask extends Object implements Runnable）。可以通过new Timer(true)设置为后台线程。</p> <p>有以下几个方法：</p> <ul><li>void schedule(TimerTask task, Date time)：在指定的日期执行某一次任务。如果执行任务的时间早于当前时间则立刻执行。</li> <li>void schedule(TimerTask task, Date firstTime, long period)：在指定的日期之后，按指定的间隔周期性地无限循环地执行某一任务。如果执行任务的时间早于当前时间则立刻执行。</li> <li>void schedule(TimerTask task, long delay)：以当前时间为参考时间，在此基础上延迟指定的毫秒数后执行一次TimerTask任务。</li> <li>void schedule(TimerTask task, long delay, long period）：以当前时间为参考时间，在此基础上延迟指定的毫秒数，再以某一间隔无限次数地执行某一任务。</li> <li>void scheduleAtFixedRate(TimerTask task, Date firstTime, long period)：下次执行任务时间参考上次任务的结束时间，且具有“追赶性”。</li></ul> <p>TimerTask是以队列的方式一个一个被顺序执行的，所以执行的时间有可能和预期的时间不一致，因为前面的任务有可能消耗的时间较长，则后面的任务运行时间也会被延迟。
TimerTask类中的cancel方法的作用是将自身从任务队列中清除。
Timer类中的cancel方法的作用是将任务队列中的全部任务清空，并且进程被销毁。</p> <p>**Timer的缺陷：**Timer支持基于绝对时间而不是相对时间的调度机制，因此任务的执行对系统时钟变化很敏感，而ScheduledThreadPoolExecutor只支持相对时间的调度。Timer在执行所有定时任务时只会创建一个线程。如果某个任务的执行时间过长，那么将破坏其他TimerTask的定时精确性。Timer的另一个问题是，如果TimerTask抛出了一个未检查的异常，那么Timer将表现出糟糕的行为。Timer线程并不波或异常，因此当TimerTask抛出为检测的异常时将终止定时线程。</p> <p>JDK5或者更高的JDK中已经很少使用Timer.</p> <ol start="18"><li>线程安全的单例模式</li></ol> <p>建议不要采用DCL的写法，建议使用下面这种写法：</p> <div class="language-Java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">LazyInitHolderSingleton</span> <span class="token punctuation">{</span>  
    <span class="token keyword">private</span> <span class="token class-name">LazyInitHolderSingleton</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  
    <span class="token punctuation">}</span>  

    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">SingletonHolder</span> <span class="token punctuation">{</span>  
            <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">LazyInitHolderSingleton</span> INSTANCE <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LazyInitHolderSingleton</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
    <span class="token punctuation">}</span>  

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">LazyInitHolderSingleton</span> <span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  
            <span class="token keyword">return</span> <span class="token class-name">SingletonHolder</span><span class="token punctuation">.</span>INSTANCE<span class="token punctuation">;</span>  
    <span class="token punctuation">}</span>  
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>或者这种：</p> <div class="language-Java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">enum</span> <span class="token class-name">SingletonClass</span>
<span class="token punctuation">{</span>
    INSTANCE<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><ol start="19"><li>线程组ThreadGroup</li></ol> <p>为了有效地对一些线程进行组织管理，通常的情况下事创建一个线程组，然后再将部分线程归属到该组中，这样可以对零散的线程对象进行有效的组织和规划。参考以下案例：</p> <div class="language-Java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">ThreadGroup</span> tgroup <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ThreadGroup</span><span class="token punctuation">(</span><span class="token string">&quot;mavelous zzh&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span>tgroup<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Runnable</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;A: Begin: &quot;</span><span class="token operator">+</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isInterrupted</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

        <span class="token punctuation">}</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;A: DEAD: &quot;</span><span class="token operator">+</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span>tgroup<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Runnable</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;B: Begin: &quot;</span><span class="token operator">+</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isInterrupted</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

        <span class="token punctuation">}</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;B: DEAD: &quot;</span><span class="token operator">+</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>tgroup<span class="token punctuation">.</span><span class="token function">activeCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>tgroup<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>tgroup<span class="token punctuation">.</span><span class="token function">getMaxPriority</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>tgroup<span class="token punctuation">.</span><span class="token function">getParent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
tgroup<span class="token punctuation">.</span><span class="token function">interrupt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br></div></div><p>输出：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>A: Begin: Thread-0
2
mavelous zzh
10
B: Begin: Thread-1
java.lang.ThreadGroup[name=main,maxpri=10]
B: DEAD: Thread-1
A: DEAD: Thread-0
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><ol start="20"><li>多线程的异常捕获UncaughtExceptionHandler</li></ol> <p>setUncaughtExceptionHandler()的作用是对指定线程对象设置默认的异常处理器。</p> <div class="language-Java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">Thread</span> thread <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Runnable</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">int</span> a<span class="token operator">=</span><span class="token number">1</span><span class="token operator">/</span><span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
thread<span class="token punctuation">.</span><span class="token function">setUncaughtExceptionHandler</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">UncaughtExceptionHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">uncaughtException</span><span class="token punctuation">(</span><span class="token class-name">Thread</span> t<span class="token punctuation">,</span> <span class="token class-name">Throwable</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;线程：&quot;</span><span class="token operator">+</span>t<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot; 出现了异常：&quot;</span><span class="token operator">+</span>e<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
thread<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>输出：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>线程：Thread-0 出现了异常：/ by zero 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><code>setDefaultUncaughtExceptionHandler()</code>方法对所有线程对象设置异常处理器。</p> <div class="language-Java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">Thread</span> thread <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Runnable</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">int</span> a<span class="token operator">=</span><span class="token number">1</span><span class="token operator">/</span><span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">setDefaultUncaughtExceptionHandler</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">UncaughtExceptionHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">uncaughtException</span><span class="token punctuation">(</span><span class="token class-name">Thread</span> t<span class="token punctuation">,</span> <span class="token class-name">Throwable</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;线程：&quot;</span><span class="token operator">+</span>t<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot; 出现了异常：&quot;</span><span class="token operator">+</span>e<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
thread<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>输出同上，注意两者之间的区别。如果既包含setUncaughtExceptionHandler又包含setDefaultUncaughtExceptionHandler那么会被setUncaughtExceptionHandler处理，setDefaultUncaughtExceptionHandler则忽略。更多详细信息参考<a href="http://blog.csdn.net/u013256816/article/details/50417822" target="_blank" rel="noopener noreferrer">《JAVA多线程之UncaughtExceptionHandler——处理非正常的线程中止》<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p>21.ReentrantLock与synchonized区别</p> <ul><li>ReentrantLock可以中断地获取锁（void lockInterruptibly() throws InterruptedException）</li> <li>ReentrantLock可以尝试非阻塞地获取锁（boolean tryLock()）</li> <li>ReentrantLock可以超时获取锁。通过tryLock(timeout, unit)，可以尝试获得锁，并且指定等待的时间。</li> <li>ReentrantLock可以实现公平锁。通过new ReentrantLock(true)实现。</li> <li>ReentrantLock对象可以同时绑定多个Condition对象，而在synchronized中，锁对象的的wait(), notify(), notifyAll()方法可以实现一个隐含条件，如果要和多于一个的条件关联的对象，就不得不额外地添加一个锁，而ReentrantLock则无需这样做，只需要多次调用newCondition()方法即可。</li></ul> <ol start="22"><li>使用多线程的优势</li></ol> <p>更多的处理器核心；更快的响应时间；更好的编程模型。</p> <ol start="23"><li>构造线程</li></ol> <p>一个新构造的线程对象是由其parent线程来进行空间分配的，而child线程继承了parent线程的：是否为Daemon、优先级、加载资源的contextClassLoader以及InheritableThreadLocal(参考第12条)，同时还会分配一个唯一的ID来标志这个child线程。</p> <ol start="24"><li>使用多线程的方式</li></ol> <p>extends Thread 或者implements Runnable</p> <ol start="25"><li>读写锁</li></ol> <p>读写锁在同一时刻可以允许多个读线程访问，但是在写线程访问时，所有的读线程和其他写线程均被阻塞。读写锁维护了一对锁，一个读锁和一个写锁，通过分离读锁和写锁，使得并发性相比一般的排它锁有了很大的提升。Java中使用ReentrantReadWriteLock实现读写锁，读写锁的一般写法如下(修改自JDK7中的示例)：</p> <div class="language-Java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">class</span> <span class="token class-name">RWDictionary</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> m <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TreeMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">ReentrantReadWriteLock</span> rwl <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ReentrantReadWriteLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">Lock</span> r <span class="token operator">=</span> rwl<span class="token punctuation">.</span><span class="token function">readLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">Lock</span> w <span class="token operator">=</span> rwl<span class="token punctuation">.</span><span class="token function">writeLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">get</span><span class="token punctuation">(</span><span class="token class-name">String</span> key<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        r<span class="token punctuation">.</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> m<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
            r<span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">allKeys</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        r<span class="token punctuation">.</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> m<span class="token punctuation">.</span><span class="token function">keySet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
            r<span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">put</span><span class="token punctuation">(</span><span class="token class-name">String</span> key<span class="token punctuation">,</span> <span class="token class-name">Object</span> value<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        w<span class="token punctuation">.</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> m<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
            w<span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        w<span class="token punctuation">.</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            m<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
            w<span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
 <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br></div></div><p>26.锁降级</p> <p>锁降级是指写锁降级成读锁。如果当前线程拥有写锁，然后将其释放，最后获取读锁，这种分段完成的过程不能称之为锁降级。锁降级是指把持住（当前拥有的）写锁，再获取到读锁，最后释放（先前拥有的）写锁的过程。参考下面的示例：</p> <div class="language-Java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">ReentrantReadWriteLock</span> rwl <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ReentrantReadWriteLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">Lock</span> r <span class="token operator">=</span> rwl<span class="token punctuation">.</span><span class="token function">readLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">Lock</span> w <span class="token operator">=</span> rwl<span class="token punctuation">.</span><span class="token function">writeLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">private</span> <span class="token keyword">volatile</span> <span class="token keyword">static</span> <span class="token keyword">boolean</span> update <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">processData</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    r<span class="token punctuation">.</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>update<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//必须先释放读锁</span>
        r<span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//锁降级从写锁获取到开始</span>
        w<span class="token punctuation">.</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>update<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">//准备数据的流程（略）</span>
                update <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            r<span class="token punctuation">.</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
            w<span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">//锁降级完成，写锁降级为读锁</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token comment">//使用数据的流程（略）</span>
    <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
        r<span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br></div></div><p>锁降级中的读锁是否有必要呢？答案是必要。主要是为了保证数据的可见性，如果当前线程不获取读锁而是直接释放写锁，假设此刻另一个线程（T）获取了写锁并修改了数据，那么当前线程无法感知线程T的数据更新。如果当前线程获取读锁，即遵循锁降级的步骤，则线程T将会被阻塞，直到当前线程使用数据并释放读锁之后，线程T才能获取写锁进行数据更新。</p></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/yupaits/blog/edit/master/post/dev/java/java-advanced/thread-1.md" target="_blank" rel="noopener noreferrer">在 GitHub 上编辑此页</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">2020-2-4 17:41:37</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/dev/java/java-advanced/linux-io.html" class="prev">
        Linux IO模式及select、poll、epoll详解
      </a></span> <span class="next"><a href="/dev/java/java-advanced/thread-2.html">
        Java多线程知识汇总(2)
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.e20fb6cd.js" defer></script><script src="/assets/js/2.0f713cb8.js" defer></script><script src="/assets/js/115.a1d34811.js" defer></script>
  </body>
</html>
